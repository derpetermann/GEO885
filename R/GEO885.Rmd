---
title: "GEO885"
author: "Gregory Biland"
date: "3/7/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
Sys.setenv(LANG = "en")


library(tidyverse)
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggmap)
library(flightplot)
library(sf)
library(shiny)
library(geosphere)


```

```{r}
airports <- read.csv("~/Desktop/UZH/MSc Geographie/2. Semester/GEO885 - GIS Science Project/GEO885/Data and Code/GIUZ_AirTravel_20210509/airports.csv")

amm <- read.csv("~/Desktop/UZH/MSc Geographie/2. Semester/GEO885 - GIS Science Project/GEO885/Data and Code/GIUZ_AirTravel_20210509/AIRTRAVELS.csv")

world <- st_read("/Users/chaualala/Desktop/UZH/MSc Geographie/2. Semester/GEO885 - GIS Science Project/GEO885/Data and Code/TM_WORLD_BORDERS_SIMPL-0 Kopie")

```

```{r}
airports <- airports %>% dplyr::select(-c(continent, home_link, wikipedia_link, elevation_ft, municipality, scheduled_service, type, keywords, name, ident, iso_region, gps_code,local_code))
airports <- subset(airports, iata_code != "")

airports <- airports %>% st_as_sf(coords = c("longitude_deg", "latitude_deg"), crs = 4326) %>% rename(coordinates = geometry)

amm_arr <- left_join(amm,airports, by = c("ARRIVAL_AIRPORT" = "iata_code"))
amm_arr <- amm_arr %>% rename(arr_coordinates = coordinates,
                      dep_country = iso_country)

amm <- amm %>% subset(DIVISION != "Support&Mangement")
amm <- left_join(amm,airports, by = c("DEPARTURE_AIRPORT" = "iata_code"))
amm <- amm %>% rename(dep_coordinates = coordinates,
                      dep_country = iso_country)
amm <- left_join(amm,airports, by = c("ARRIVAL_AIRPORT" = "iata_code"))
amm <- amm %>% rename(arr_coordinates = coordinates,
                      arr_country = iso_country)

```

```{r}

ggplot() +
  geom_sf(data=world, lwd = .5)+
  geom_sf(data = amm, aes(geometry = dep_coordinates, col = "dep_coordinates")) +
  geom_sf(data = amm, aes(geometry = arr_coordinates, col = "arr_coordinates")) +
  labs(fill = "Flight type") +
  theme(panel.grid.minor = element_blank())+
  ggtitle("Departure and arrival locations for all GIUZ flights separated by symbols")+
  xlab("Longitude") + ylab("Latitude")

```

```{r}
amm_arr <- st_as_sf(amm_arr)

flightmap <- st_join(world, amm_arr, join = st_contains_properly, left=TRUE)
flightmap_sort <- flightmap %>% group_by(NAME) %>% count()
flightmap_sort

# create map
ggplot() +
  geom_sf(data=world)+
  geom_sf(data = flightmap_sort, aes(fill = n)) +
  labs(fill = "Locations per country") +
  scico::scale_fill_scico(palette = "bilbao")+  
  theme(panel.grid.minor = element_blank())+
  ggtitle("Arrival locations for all GIUZ flights counnted by country")+
  xlab("Longitude") + ylab("Latitude")+
  theme(legend.position = "none")

```


```{r Flightpath}

flightpath <- cbind(amm$DEPARTURE_AIRPORT,
                     amm$ARRIVAL_AIRPORT) %>% as.data.frame()
flightpath <- flightpath %>% rename(Departure = V1,
                                    Arrival = V2)
flightpath <- subset(flightpath, Departure != "" & Arrival != "")


plot_flights(flightpath)

lines <- amm %>% rowwise() %>% gcIntermediate(dep_coordinates, arr_coordinates, n=50)

ggplot() +
  geom_sf(data=world, lwd = .5)+
  geom_sf(data = amm, aes(geometry = dep_coordinates, col = "dep_coordinates")) +
  geom_sf(data = amm, aes(geometry = arr_coordinates, col = "arr_coordinates")) +
  geom_line()


```
```{r FLight Statistic}
amm_emissions <- amm %>% 
  group_by(YEAR) %>% 
  summarise(total_emission = sum(EMISSIONS_KGCO2EQ))


```

